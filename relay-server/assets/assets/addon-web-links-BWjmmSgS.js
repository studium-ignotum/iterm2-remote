/**
 * Copyright (c) 2014-2024 The xterm.js authors. All rights reserved.
 * @license MIT
 *
 * Copyright (c) 2012-2013, Christopher Jeffrey (MIT License)
 * @license MIT
 *
 * Originally forked from (with the author's permission):
 *   Fabrice Bellard's javascript vt100 for jslinux:
 *   http://bellard.org/jslinux/
 *   Copyright (c) 2011 Fabrice Bellard
 */var L=class{constructor(i,e,t,r={}){this._terminal=i,this._regex=e,this._handler=t,this._options=r}provideLinks(i,e){let t=x.computeLink(i,this._regex,this._terminal,this._handler);e(this._addCallbacks(t))}_addCallbacks(i){return i.map(e=>(e.leave=this._options.leave,e.hover=(t,r)=>{if(this._options.hover){let{range:l}=e;this._options.hover(t,r,l)}},e))}};function m(i){try{let e=new URL(i),t=e.password&&e.username?`${e.protocol}//${e.username}:${e.password}@${e.host}`:e.username?`${e.protocol}//${e.username}@${e.host}`:`${e.protocol}//${e.host}`;return i.toLocaleLowerCase().startsWith(t.toLocaleLowerCase())}catch{return!1}}var x=class d{static computeLink(e,t,r,l){let h=new RegExp(t.source,(t.flags||"")+"g"),[n,s]=d._getWindowedLineStrings(e-1,r),a=n.join(""),o,c=[];for(;o=h.exec(a);){let p=o[0];if(!m(p))continue;let[u,g]=d._mapStrIdx(r,s,0,o.index),[f,_]=d._mapStrIdx(r,u,g,p.length);if(u===-1||g===-1||f===-1||_===-1)continue;let v={start:{x:g+1,y:u+1},end:{x:_,y:f+1}};c.push({range:v,text:p,activate:l})}return c}static _getWindowedLineStrings(e,t){let r,l=e,h=e,n=0,s="",a=[];if(r=t.buffer.active.getLine(e)){let o=r.translateToString(!0);if(r.isWrapped&&o[0]!==" "){for(n=0;(r=t.buffer.active.getLine(--l))&&n<2048&&(s=r.translateToString(!0),n+=s.length,a.push(s),!(!r.isWrapped||s.indexOf(" ")!==-1)););a.reverse()}for(a.push(o),n=0;(r=t.buffer.active.getLine(++h))&&r.isWrapped&&n<2048&&(s=r.translateToString(!0),n+=s.length,a.push(s),s.indexOf(" ")===-1););}return[a,l]}static _mapStrIdx(e,t,r,l){let h=e.buffer.active,n=h.getNullCell(),s=r;for(;l;){let a=h.getLine(t);if(!a)return[-1,-1];for(let o=s;o<a.length;++o){a.getCell(o,n);let c=n.getChars();if(n.getWidth()&&(l-=c.length||1,o===a.length-1&&c==="")){let p=h.getLine(t+1);p&&p.isWrapped&&(p.getCell(0,n),n.getWidth()===2&&(l+=1))}if(l<0)return[t,o]}t++,s=0}return[t,s]}},w=/(https?|HTTPS?):[/]{2}[^\s"'!*(){}|\\\^<>`]*[^\s"':,.!?{}|\\\^~\[\]`()<>]/;function k(i,e){let t=window.open();if(t){try{t.opener=null}catch{}t.location.href=e}else console.warn("Opening link blocked as opener could not be cleared")}var b=class{constructor(i=k,e={}){this._handler=i,this._options=e}activate(i){this._terminal=i;let e=this._options,t=e.urlRegex||w;this._linkProvider=this._terminal.registerLinkProvider(new L(this._terminal,t,this._handler,e))}dispose(){var i;(i=this._linkProvider)==null||i.dispose()}};export{b as WebLinksAddon};
