---
phase: 04-relay-server
plan: 03
type: execute
wave: 3
depends_on: ["04-01", "04-02"]
files_modified:
  - relay-server-v2/web-ui/dist/index.html
  - relay-server-v2/src/assets.rs
  - relay-server-v2/src/main.rs
autonomous: true

must_haves:
  truths:
    - "Web UI is accessible at server root (/)"
    - "Static assets are embedded in the binary (no external files needed)"
    - "HTML page loads and shows placeholder content"
  artifacts:
    - path: "relay-server-v2/web-ui/dist/index.html"
      provides: "Placeholder web UI"
      contains: "Terminal Remote"
    - path: "relay-server-v2/src/assets.rs"
      provides: "rust-embed configuration"
      contains: "RustEmbed"
  key_links:
    - from: "relay-server-v2/src/main.rs"
      to: "relay-server-v2/src/assets.rs"
      via: "ServeEmbed"
      pattern: "nest_service"
---

<objective>
Embed a placeholder web UI in the relay server binary using rust-embed.

Purpose: Enable single-binary distribution where the relay serves its own web interface without external files.
Output: Server serves embedded HTML at root path, ready for real UI in Phase 7.
</objective>

<execution_context>
@/Users/nat/.claude/get-shit-done/workflows/execute-plan.md
@/Users/nat/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/04-relay-server/04-RESEARCH.md
@.planning/phases/04-relay-server/04-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create placeholder web UI</name>
  <files>relay-server-v2/web-ui/dist/index.html, relay-server-v2/web-ui/dist/style.css</files>
  <action>
Create the web-ui/dist/ directory with a minimal placeholder UI.

Create web-ui/dist/index.html:
```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terminal Remote</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <div class="container">
        <h1>Terminal Remote</h1>
        <p class="status">Relay Server v2.0</p>

        <div class="connect-form">
            <label for="session-code">Session Code:</label>
            <input type="text" id="session-code" placeholder="ABC123" maxlength="6" autocomplete="off">
            <button id="connect-btn">Connect</button>
        </div>

        <div id="message" class="message"></div>
    </div>

    <script>
        // Placeholder - real WebSocket connection in Phase 7
        document.getElementById('connect-btn').addEventListener('click', () => {
            const code = document.getElementById('session-code').value.toUpperCase();
            const msg = document.getElementById('message');
            if (code.length !== 6) {
                msg.textContent = 'Session code must be 6 characters';
                msg.className = 'message error';
            } else {
                msg.textContent = 'WebSocket connection not yet implemented (Phase 7)';
                msg.className = 'message info';
            }
        });
    </script>
</body>
</html>
```

Create web-ui/dist/style.css:
```css
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    background: #1a1a2e;
    color: #eee;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
}

.container {
    text-align: center;
    padding: 2rem;
}

h1 {
    font-size: 2rem;
    margin-bottom: 0.5rem;
}

.status {
    color: #888;
    margin-bottom: 2rem;
}

.connect-form {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    max-width: 300px;
    margin: 0 auto;
}

label {
    text-align: left;
    font-size: 0.9rem;
    color: #aaa;
}

input {
    padding: 0.75rem;
    font-size: 1.5rem;
    text-align: center;
    letter-spacing: 0.3em;
    text-transform: uppercase;
    border: 2px solid #333;
    border-radius: 8px;
    background: #16213e;
    color: #fff;
}

input:focus {
    outline: none;
    border-color: #0f4c75;
}

button {
    padding: 0.75rem;
    font-size: 1rem;
    background: #0f4c75;
    color: #fff;
    border: none;
    border-radius: 8px;
    cursor: pointer;
}

button:hover {
    background: #1b6ca8;
}

.message {
    margin-top: 1.5rem;
    padding: 0.75rem;
    border-radius: 8px;
    min-height: 1.5rem;
}

.message.error {
    background: #5c2a2a;
    color: #ffaaaa;
}

.message.info {
    background: #2a3d5c;
    color: #aaccff;
}
```
  </action>
  <verify>
```bash
ls -la relay-server-v2/web-ui/dist/
cat relay-server-v2/web-ui/dist/index.html | head -10
```
  </verify>
  <done>Placeholder HTML and CSS files exist in web-ui/dist/</done>
</task>

<task type="auto">
  <name>Task 2: Configure rust-embed and wire to router</name>
  <files>relay-server-v2/src/assets.rs, relay-server-v2/src/main.rs</files>
  <action>
Create src/assets.rs with rust-embed configuration:

```rust
use rust_embed::RustEmbed;

#[derive(RustEmbed, Clone)]
#[folder = "web-ui/dist"]
pub struct Assets;
```

Update main.rs to serve embedded assets:

1. Add `mod assets;` declaration
2. Import `axum_embed::ServeEmbed` and `assets::Assets`
3. Replace the placeholder "/" route with ServeEmbed:

```rust
use axum_embed::ServeEmbed;
use assets::Assets;

// In router setup, REMOVE the placeholder "/" route and add:
let serve_assets = ServeEmbed::<Assets>::with_parameters(None, axum_embed::FallbackBehavior::Ok, None);

let app = Router::new()
    .route("/ws", get(ws_handler_placeholder))  // Placeholder for Phase 4 Plan 04
    .route("/debug/sessions", get(debug_sessions))
    .fallback_service(serve_assets)  // Serve static files, fallback to index.html
    .with_state(state);
```

Note: Use `fallback_service` so that:
- Known routes (/ws, /debug/sessions) are handled by axum
- All other paths serve from embedded assets
- Unknown paths return index.html (SPA behavior)

Add a placeholder ws_handler for now (will be implemented in Plan 04):
```rust
async fn ws_handler_placeholder() -> &'static str {
    "WebSocket endpoint - not yet implemented"
}
```
  </action>
  <verify>
```bash
cd relay-server-v2 && cargo build 2>&1 | tail -5
cd relay-server-v2 && cargo run &
sleep 2
curl -s http://localhost:3000/ | head -5
curl -s http://localhost:3000/style.css | head -3
curl http://localhost:3000/nonexistent  # Should return index.html
pkill -f "relay-server"
```
Expected: HTML content at /, CSS at /style.css, index.html for unknown paths
  </verify>
  <done>Embedded assets served at root, SPA fallback works, binary has no external dependencies</done>
</task>

</tasks>

<verification>
1. `cargo build --release` produces single binary
2. Running binary serves HTML at /
3. CSS loads correctly
4. Unknown paths return index.html (SPA fallback)
</verification>

<success_criteria>
- web-ui/dist/ contains index.html and style.css
- rust-embed compiles assets into binary
- Server serves embedded files without external filesystem access
- SPA fallback returns index.html for unknown routes
- Build produces single binary with embedded UI
</success_criteria>

<output>
After completion, create `.planning/phases/04-relay-server/04-03-SUMMARY.md`
</output>
